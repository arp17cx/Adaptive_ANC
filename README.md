# è‡ªé€‚åº”ä¸»åŠ¨é™å™ª(ANC)ç³»ç»Ÿ - è§„èŒƒåŒ–é¡¹ç›®ç»“æ„

## ğŸ“ é¡¹ç›®ç»“æ„

```
ANC_Project/
â”œâ”€â”€ src/                    æºä»£ç 
â”‚   â”œâ”€â”€ main.c              - ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ wav_io.c            - WAVæ–‡ä»¶I/O
â”‚   â”œâ”€â”€ fir_filter.c        - FIRæ»¤æ³¢å™¨
â”‚   â”œâ”€â”€ time_domain_sim.c   - æ—¶åŸŸä»¿çœŸ
â”‚   â””â”€â”€ logger.c            - æ—¥å¿—ç®¡ç†
â”‚
â”œâ”€â”€ inc/                    å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ config.h            - ç³»ç»Ÿé…ç½®
â”‚   â”œâ”€â”€ coeffs.h            - å‚æ•°å®šä¹‰
â”‚   â”œâ”€â”€ wav_io.h
â”‚   â”œâ”€â”€ fir_filter.h
â”‚   â”œâ”€â”€ time_domain_sim.h
â”‚   â””â”€â”€ logger.h
â”‚
â”œâ”€â”€ result/                 è¾“å‡ºç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚   â”œâ”€â”€ anc_log.txt         - è¿è¡Œæ—¥å¿—
â”‚   â””â”€â”€ output_comparison.wav - å¯¹æ¯”éŸ³é¢‘
â”‚
â”œâ”€â”€ docs/                   æ–‡æ¡£
â”‚   â””â”€â”€ (è¯´æ˜æ–‡æ¡£)
â”‚
â”œâ”€â”€ build.bat               ç¼–è¯‘è„šæœ¬
â”œâ”€â”€ run.bat                 ä¸€é”®è¿è¡Œ
â”œâ”€â”€ clean.bat               æ¸…ç†
â””â”€â”€ README.md               æœ¬æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Windowsç”¨æˆ·

1. **å®‰è£…gcc** (åªéœ€ä¸€æ¬¡)
   - ä¸‹è½½ TDM-GCC: https://jmeubank.github.io/tdm-gcc/
   - å®‰è£…æ—¶å‹¾é€‰ "Add to PATH"

2. **è¿è¡Œç¨‹åº**
   ```
   åŒå‡» run.bat
   ```

3. **æŸ¥çœ‹ç»“æœ**
   - æ—¥å¿—: `result/anc_log.txt`
   - éŸ³é¢‘: `result/output_comparison.wav`

### æ‰‹åŠ¨ç¼–è¯‘

```batch
build.bat      # ç¼–è¯‘
anc_system.exe # è¿è¡Œ
```

## â±ï¸ æ—¶åºè¯´æ˜ (é‡è¦!)

### æ­£ç¡®çš„è¿­ä»£æ—¶åº

```
Iteration 0: 0-325ms
  [Phase 1] DSP Processing
    - 0-100ms: ç´¯ç§¯æ•°æ®
    - 100-325ms: 10æ¬¡FFT (75%æ»‘çª—)
    - è®¡ç®—æ–°å‚æ•°
  
  [Phase 2] Time Domain Filtering
    - ç”¨æ–°å‚æ•°æ»¤æ³¢ 325ms-end çš„æ‰€æœ‰ä¿¡å·
    - æ›´æ–° simulated_fb[325ms-end]

Iteration 1: 325-650ms
  [Phase 1] DSP Processing
    - 325-425ms: ç´¯ç§¯
    - 425-650ms: 10æ¬¡FFT
    - è®¡ç®—æ–°å‚æ•°
  
  [Phase 2] Time Domain Filtering
    - ç”¨æ–°å‚æ•°æ»¤æ³¢ 650ms-end
    - æ›´æ–° simulated_fb[650ms-end]

ä¾æ­¤ç±»æ¨...
```

### å…³é”®ç‚¹

- âœ… æ¯è½®å¤„ç†å›ºå®š325msæ•°æ®
- âœ… DSPä½¿ç”¨: åŸå§‹FF + é™å™ªåFB (ä¸Šä¸€è½®ç»“æœ)
- âœ… æ»¤æ³¢èŒƒå›´: å½“å‰è¾¹ç•Œåçš„æ‰€æœ‰å‰©ä½™ä¿¡å·
- âœ… ä¸‹ä¸€è½®ä»å½“å‰è¾¹ç•Œå¼€å§‹

## ğŸ“Š è¾“å‡ºè¯´æ˜

### æ—¥å¿—æ–‡ä»¶ (result/anc_log.txt)

åŒ…å«å®Œæ•´çš„è¿è¡Œè¿‡ç¨‹:
- æ¯æ¬¡è¿­ä»£çš„æ—¶é—´èŒƒå›´
- DSPå¤„ç†è¯¦æƒ…
- å‚æ•°æ›´æ–°è®°å½•
- æ—¶åŸŸæ»¤æ³¢çŠ¶æ€

### éŸ³é¢‘æ–‡ä»¶ (result/output_comparison.wav)

2é€šé“å¯¹æ¯”:
- é€šé“1: åŸå§‹å‚è€ƒéº¦ä¿¡å·
- é€šé“2: é™å™ªåçš„è¯¯å·®éº¦ä¿¡å·

## âš™ï¸ å¯é€‰è¾“å…¥æ–‡ä»¶

æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•:
- `input_4ch.wav` - 4é€šé“WAV (å¯é€‰)
- `secondary_path.bin` - æ¬¡çº§è·¯å¾„ (å¯é€‰)

ä¸æä¾›æ—¶è‡ªåŠ¨ä½¿ç”¨æ¨¡æ‹Ÿä¿¡å·ã€‚

## ğŸ¯ ç®—æ³•ç‰¹æ€§

1. **DSPå‹å¥½ä¼˜åŒ–** - ä¾æ¬¡ä¼˜åŒ–å‚æ•°
2. **ä¸¥æ ¼æ—¶åº** - 325msä¸€è½®è¿­ä»£
3. **å®Œæ•´ä»¿çœŸ** - Biquad + FIRé—­ç¯
4. **ç¨³å®šæ€§æ£€æµ‹** - é˜²æ­¢å‘æ•£

## ğŸ› ï¸ ä¿®æ”¹é…ç½®

ç¼–è¾‘ `inc/coeffs.h`:

```c
// ä¿®æ”¹è¿­ä»£æ—¶é—´
// (åœ¨main.cä¸­: float iteration_time_ms = 325.0f)

// ä¿®æ”¹è¾“å‡ºè·¯å¾„
#define LOG_OUTPUT_PATH "result/anc_log.txt"
#define WAV_OUTPUT_PATH "result/output_comparison.wav"
```

## ğŸ“ å¼€å‘è¯´æ˜

### ç¼–è¯‘é€‰é¡¹

```batch
gcc -c src/xxx.c -o xxx.o -Iinc -Wall -O2
```

- `-Iinc`: æŒ‡å®šå¤´æ–‡ä»¶ç›®å½•
- `-Wall`: æ˜¾ç¤ºæ‰€æœ‰è­¦å‘Š
- `-O2`: ä¼˜åŒ–çº§åˆ«2

### æ·»åŠ æ–°æ¨¡å—

1. æºæ–‡ä»¶æ”¾åœ¨ `src/`
2. å¤´æ–‡ä»¶æ”¾åœ¨ `inc/`
3. ä¿®æ”¹ `build.bat` æ·»åŠ ç¼–è¯‘å‘½ä»¤

## â“ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæ˜¯325msä¸€è½®?

A: 
- ç´¯ç§¯100ms
- 10æ¬¡FFTè¦†ç›–çº¦208-244ms
- è€ƒè™‘å¤„ç†å»¶è¿Ÿï¼Œç”¨æˆ·æŒ‡å®š325ms

### Q: resultæ–‡ä»¶å¤¹ä¸å­˜åœ¨?

A: build.batä¼šè‡ªåŠ¨åˆ›å»º

### Q: ç¼–è¯‘é”™è¯¯ "No such file"?

A: ç¡®ä¿æ‰€æœ‰æºæ–‡ä»¶éƒ½åœ¨ src/ å’Œ inc/ ç›®å½•

---

**ç‰ˆæœ¬**: 2.0 è§„èŒƒåŒ–ç»“æ„  
**æ—¥æœŸ**: 2024  
**å¹³å°**: Windows (GCC)
